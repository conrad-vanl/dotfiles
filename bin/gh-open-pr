#!/usr/bin/env bash
# ****************************************************
#
#   GitHub Open Pull Request
#   -> Opens the Pull Request for the current branch
#
# ----------------------------------------------------
#   Usage
# ----------------------------------------------------
#
#  `gh-open-pr`
#
# ****************************************************

set -o errexit
set -o nounset
set -o pipefail

# ----------------------------------------------------
#   Functions
# ----------------------------------------------------

remote_url() {
  git remote -v | grep "^$1" | head -1 | grep -o 'github.com[/:]\S\+'
}

# ----------------------------------------------------
#   Variables
# ----------------------------------------------------

branch="${1:-$(git symbolic-ref HEAD)}"
branch="${branch#refs/heads/}"
url="$(remote_url upstream || true)"
url="${url:-$(remote_url github || true)}"
url="${url:-$(remote_url origin || true)}"
url="${url%.git}"

# ----------------------------------------------------
#   Main
# ----------------------------------------------------

open "https://${url/://}/pull/${branch//\//%2F}"
